#!/bin/bash

# vdir is a storage format used by vdirsyncer

org=~/Dropbox/Agenda/outlook.org
vdir=~/.local/share/calendar/outlook/*.ics
vdir_single_file=$(mktemp)

rm org 2> /dev/null
echo "Removed $org"

cat $vdir > "$vdir_single_file"
/usr/bin/nvim --clean --headless -n -es +':2,$-1g/\(BEGIN\|END\):VCALENDAR/d' +wq $vdir_single_file
echo "Cat calendar: $vdir into a single file: $vdir_single_file"

ical2orgpy $vdir_single_file $org
echo "Convert vdir: $vdir_single_file into org agenda: $org"

rm $vdir_single_file
echo "Remove: $vdir_single_file"
