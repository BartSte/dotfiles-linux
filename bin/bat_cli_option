#!/usr/bin/bash

get_line_number() {
    local line_number line_number_and_word
    line_number_and_word="$1"
    options="$2"

    line_number=$(echo "$options" | 
                  ag -Q -- "$line_number_and_word" | 
                  head -1 | sed "s/:.*$//g")

    [ -z $line_number ] && line_number=0
    echo "$line_number"
}

get_scroll_lines() {
    local half_page line_number

    line_number=$1
    half_page=$(get_half_page)

    scroll=$(($line_number-$half_page));
    scroll=$(($scroll > 0 ? $scroll : 0));

    echo $scroll
}

get_half_page() {
    local number_of_lines

    number_of_lines=$FZF_PREVIEW_LINES 
    [ -z $number_of_lines ] && number_of_lines=$LINES

    echo $(($number_of_lines / 2))
}

#TODO think about caching the options of the last cmd.
cmd="$1"
option="$2" 

options=$(get_cli_options $cmd)
line_number=$(get_line_number $option "$options")
scroll=$(get_scroll_lines $line_number)

printf '\033[2J'
"$cmd" --help | 
bat -f -p --wrap never -H $line_number -r $scroll: --theme Dracula;
