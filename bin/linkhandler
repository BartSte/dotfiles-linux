#!/usr/bin/env bash

show_usage() {
    cat <<EOF
Usage: $0 <link>
Opens a link in a preferred program.
EOF
}

[ -z "$1" ] && echo "No link provided." && show_usage && exit 1

link=$1

# Check if the link contains '.py'
if [[ $link == *.py:* ]]; then

    file=$(echo $link | cut -d ':' -f 1)
    line=$(echo $link | cut -d ':' -f 2)

    session=$(tmux display-message -p '#S')
    window=0
    pane=0

    if [[ $(tmux list-windows -t $session | grep -c "$window: nvim") -eq 0 ]]; then
        tmux display-message -d 2000 "No neovim session found in window $window of session $session."
        exit 1
    fi

    tmux send-keys -t $session:$window.$pane C-c
    tmux send-keys -t $session:$window.$pane ":e $file|$line"
    tmux send-keys -t $session:$window.$pane Enter

else
    $BROWSER $1 &>/dev/null &
fi
