source "~/.mutt/user"

source "~/.mutt/aliases"
source "~/.mutt/gal"
source "~/.mutt/mailing_lists"
source "~/.mutt/lang/$my_lang"

# General
alternative_order text/plain text/enriched text/html
auto_view text/html
set editor="vim"
set index_format=" %?M?   â†³&%4C?   %Z      %D     %-15.15n    %s"
set mail_check=90
set pager_stop="yes"
set reverse_alias=yes
set reverse_name=yes
set reverse_realname=yes
set smart_wrap="yes"
set sort=threads
set sort_browser=date
set sort_aux=reverse-last-date-received
set timeout=15
unset collapse_unread
unset mark_old

# IMAP config
set imap_user="$my_username@$my_domain"
set imap_pass=$my_password
set imap_authenticators="$my_auth"
set imap_oauth_refresh_command="~/.mutt/authentication/mutt_oauth2.py ~/.mutt/authentication/${imap_user}.tokens"
set imap_check_subscribed="no"
set imap_list_subscribed="no"
set imap_keepalive=180
set imap_idle
set folder="imaps://${imap_user}@outlook.office365.com/"
set spoolfile= +INBOX
set postponed= +$my_drafts_noquote
set record= +$my_sent_noquote
set trash= +$my_trash_noquote
mailboxes

# SMTP config
set realname = $my_realname
set from = "$my_username@$my_domain"
set smtp_pass = $my_password
set hostname = $my_domain
set smtp_url = "smtp://${imap_user}@smtp.office365.com:587/"
set ssl_force_tls = yes
set smtp_authenticators=${imap_authenticators}
set smtp_oauth_refresh_command=${imap_oauth_refresh_command}
set ssl_use_sslv3=yes

# Paths
set alias_file="~/.mutt/aliases"
set header_cache="~/.mutt/header_cache"
set message_cachedir="~/.mutt/message_cache"
set signature="~/.mutt/signature"
set tmpdir="~/.mutt/tmp"

## Key bindings

# Mailboxes
bind    index   G  imap-fetch-mail
bind    index   <esc>V noop
bind    index   <esc>v noop
bind    index   \Cn noop
bind    index   \Cp noop
bind    index   g   noop
macro   index   gi "<change-folder>=INBOX<enter>"       "Go to Inbox"
macro   index   ga "<change-folder>=ARCHIVE<enter>"     "Go to Archive"
macro   index   gl "<change-folder>=Gitlab<enter>"      "Go to Gitlab"
macro   index   gs "<change-folder>=$my_sent<enter>"    "Go to Sent"
macro   index   gd "<change-folder>=$my_drafts<enter>"  "Go to Drafts"
macro   index   gt "<change-folder>=$my_trash<enter>"   "Go to Trash"

# Index
bind    index   <up>        previous-entry
bind    index   <down>      next-entry
bind    index   <delete>    delete-message

# Pager
bind    pager   <up>        previous-line
bind    pager   <down>      next-line
bind    pager   <left>      previous-entry
bind    pager   <right>     next-entry
bind    pager   <delete>    delete-message
bind    pager   k           previous-line
bind    pager   j           next-line

# Vim like bindings 
bind alias,index,browser,query G last-entry
bind pager G bottom

bind alias,index,browser,query gg first-entry
bind pager gg top

bind index,pager A create-alias
bind index,pager a group-reply

bind alias,index,pager,browser,query \Cd half-down
bind alias,index,pager,browser,query \Cu half-up

bind index n search-next
bind index N search-opposite

bind index K previous-thread
bind pager K half-up

bind index J next-thread
bind pager J half-down

bind editor <up> history-up
bind editor <down> history-down

# Limit messages quickly using ' + key.
macro index \'d  "<limit>~D<enter>"       "limit to deleted messages"
macro index \'f  "<limit>~F<enter>"       "limit to flagged messages"
macro index \'n  "<limit>~N|~O<enter>"    "limit to new messages"
macro index \'u  "<limit>!~Q<enter>"      "limit to unreplied messages"
macro index \'\' "<limit>~A<enter>"       "reset all limits"

# Macros
macro   index,pager y "<change-folder>?<toggle-mailboxes>" "show incoming mailboxes list"
bind    browser y exit
macro   index,pager A "<save-message>=ARCHIVE<enter>" "Archive Message"

# Colors
color   normal      white default
color   attachment  brightyellow default
color   hdrdefault  cyan default
color   indicator   black cyan
color   markers     brightred default
color   quoted      green default
color   signature   cyan default
color   status      brightgreen blue
color   tilde       blue default
color   tree        red default
color   header      brightgreen default ^From:
color   header      brightcyan default ^To:
color   header      brightcyan default ^Reply-To:
color   header      brightcyan default ^Cc:
color   header      brightblue default ^Subject:
color   body        brightred default [\-\.+_a-zA-Z0-9]+@[\-\.a-zA-Z0-9]+
color   body        brightblue default (https?|ftp)://[\-\.,/%~_:?&=\#a-zA-Z0-9]+

set markers=no # don't put '+' at the beginning of wrapped lines
set pager_index_lines= 5 # how large is the index window?
