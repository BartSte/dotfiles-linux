# vim: filetype=neomuttrc
source ~/dotfiles-linux/mutt/khard.muttrc
source ~/dotfiles-linux/mutt/binds.muttrc

# Style
source ~/.config/neomutt/gruvbox/colors-gruvbox-shuber.muttrc 
source ~/.config/neomutt/gruvbox/powerline/colors/gruvbox-powerline.neomuttrc
source ~/.config/neomutt/gruvbox/powerline/powerline.neomuttrc

# Variables
set my_email=`rbw_get username $MICROSOFT_ACCOUNT`
set my_password=`rbw_get MuttPassword $MICROSOFT_ACCOUNT`

# General
set allow_ansi  # allow ansi escape codes (e.g. colors)
set beep=no  # don't beep for errors
set confirmappend=no
set count_alternatives=yes  # recurse into text/multipart when looking for attachement types
set editor="nvim"
set fast_reply
set forward_format = "FW: %s" # format of subject when forwarding
set forward_quote  # quote forwarded message
set date_format = "%H:%M %d-%b-%y"
set index_format=" %?M?   â†³&%4C?   %Z      %D     %-15.15n    %s"
set mail_check=120
set mailcap_path = "~/dotfiles-linux/mutt/mailcap"
set markers=no  # don't put '+' at the beginning of wrapped lines
set menu_scroll  # scroll in menus
set pager_context = 3  # number of context lines to show
set pager_index_lines = 10 # number of index lines to show
set pager_stop  # don't go to next message automatically
set quote_regexp = "^( {0,4}[>|:#%]| {0,4}[a-z0-9]+[>|]+)+"
set reply_regexp = "^(([Rr][Ee]?(\[[0-9]+\])?: *)?(\[[^]]+\] *)?)*"
set reverse_alias=yes
set reverse_name  # reply as whomever it was to
set reverse_realname=yes  # use any real name provided when replying
set signature="`rbw_get notes $MICROSOFT_ACCOUNT > /tmp/mutt_signature | echo '/tmp/mutt_signature'`"
set sleep_time = 0
set smart_wrap="no"
set sort=threads
set sort_aux=reverse-last-date-received
set sort_browser=date
set timeout=15
set tmpdir="/tmp"
set wait_key = no
set wrap=0  # email view width
unset collapse_unread
unset mark_old

# IMAP config
set folder="~/.local/share/mail"
set header_cache="~/.cache/neomutt/header_cache"
set imap_authenticators=`rbw_get MuttImapAuth $MICROSOFT_ACCOUNT`
set imap_keepalive=300
set imap_oauth_refresh_command="python3 ~/dotfiles-linux/mutt/mutt_oauth2.py ~/.config/neomutt/$my_email.tokens"
set imap_pass=$my_password
set imap_user=$my_email
set mbox_type = Maildir
unset imap_idle
unset imap_passive

# SMTP config
set from = $my_email
set hostname = `rbw_get Domain $MICROSOFT_ACCOUNT`
set realname = "`rbw_get Name $MICROSOFT_ACCOUNT`"
set smtp_authenticators=`rbw_get MuttSmtpAuth $MICROSOFT_ACCOUNT`
set smtp_oauth_refresh_command="python3 ~/dotfiles-linux/mutt/mutt_oauth2.py ~/.config/neomutt/$my_email.tokens"
set smtp_pass = $my_password
set smtp_url = "smtp://$my_email@smtp.office365.com:587/"
set ssl_force_tls = yes
set ssl_use_sslv3=yes

# Mailboxes
mailboxes =INBOX =Drafts =Sent =Deleted =Archive

set postponed= +Drafts
set record= +Sent
set spoolfile= +INBOX
set trash= +Deleted

#### Header Options
ignore *                                # ignore all headers
unignore to: cc:                        # ..then selectively show only these headers
unhdr_order *                           # some distros order things by default
hdr_order from: to: cc: date: subject:  # header item ordering

#### Notmuch Config
set nm_query_type=threads  # bring in the whole thread instead of just the matched message, really useful
set nm_default_url = "notmuch:///$HOME/.local/share/mail"  # default notmuch URL
set nm_record_tags = "sent"  # default 'sent' tag
set virtual_spoolfile=yes  # allow using virtual mailboxes as spoolfile 

#### Content/Autoview
auto_view application/ics
auto_view text/calendar
auto_view text/plain
auto_view text/html
auto_view application/pgp-encrypted
alternative_order text/calendar application/ics text/plain text/enriched text/html

