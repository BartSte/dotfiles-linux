#!/bin/bash
set -eo pipefail

usage="Usage: $(basename "$0") [-h | --help] 
Runs the \`mailsync\` script for the accounts set by the \`MICROSOFT_ACCOUNT\`
environment variable. If \`MICROSOFT_ACCOUNT\` is not set, raise an error. 

where:
    -q --quiet  suppress /dev/stderr and /dev/stdout
    -h --help   shows this help messages"

args=""
account=${MICROSOFT_ACCOUNT:?"MICROSOFT_ACCOUNT not set"}

while [[ $# -gt 0 ]]; do
    case "$1" in
        -h | --help)
            echo "$usage"
            exit
            ;;
        -q | --quiet)
            args+=" --quiet"
            shift
            ;;
        --)
            shift
            break
            ;;
        *)
            echo "Internal error"
            exit 1
            ;;
    esac
done

if [ "$account" == "MicrosoftWork" ]; then
    args+=" $HOME/.config/davmail/davmail-work.properties"
fi

eval "mailsync $args"
